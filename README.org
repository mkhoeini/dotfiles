#+TITLE: dotfiles

My personal dotfiles

#+TOC: headlines

* TL;DR

Run this in the terminal. It will setup homebrew and emacs and install dependencies for you.

#+begin_src shell
  ./setup.sh
#+end_src

* Code

** Setup script
:PROPERTIES:
:header-args: :tangle setup.sh :shebang "#!/usr/bin/env zsh"
:END:

*** Fundamentals
**** Script preamble
#+begin_src shell
  set -euo pipefail
#+end_src

**** Install HomeBrew
#+begin_src shell
  if ! command -v brew >/dev/null; then
      echo "Installing HomeBrew"
      /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  fi
#+end_src
**** Install Emacs
#+begin_src shell
  if ! command -v emacs >/dev/null; then
      echo "Installing Emacs"
      brew tap d12frosted/emacs-plus
      brew install emacs-plus@29 --with-native-comp --with-modern-vscode-icon --with-xwidgets --with-imagemagick --with-poll --with-no-frame-refocus
  fi
#+end_src


*** Other Setup
**** Install Spacemacs

#+begin_src shell
  if [[ ! -e ~/.emacs.d ]]; then
      echo "Installing Spacemacs";
      git clone https://github.com/syl20bnr/spacemacs ~/.emacs.d;
  fi
#+end_src

**** Enable repeat keys

#+begin_src shell
  defaults write -g ApplePressAndHoldEnabled -bool false
#+end_src


** Dependencies

*** Homebrew Managed Dependencies
:PROPERTIES:
:header-args: :tangle setup.rb :shebang "#!/usr/bin/env ruby"
:END:

**** Taps

I didn't need tap for now. But I will keep it as a reference:

    kde-mac/kde https://invent.kde.org/packaging/homebrew-kde.git

#+Name: brew-taps-requested
#+begin_src ruby
  <<HEREDOC.gsub(/;.*$/, '').strip.split(/\s+/)
    borkdude/brew ; babashka
    ;; bufbuild/buf
    homebrew/cask-drivers ; device drivers
    homebrew/cask-fonts
    homebrew/cask-versions
    ;homebrew/command-not-found ; It's very slow. Don't use it
    mkhoeini/tap ; fortune-mod
    ;oven-sh/bun ; bun.sh
    remotemobprogramming/brew
    ;; spotify/public
    ;tnk-studio/tools ; lazykube
  HEREDOC
#+end_src

#+Name: brew-taps
#+begin_src ruby :var tap_list=brew-taps-requested
  installed = `brew tap`
  tap_list.reject { |tap| installed.include? tap }
#+end_src

#+RESULTS: brew-taps
**** Formulas

#+Name: brew-formulas-requested
#+begin_src ruby
  <<HEREDOC.gsub(/;.*$/, '').strip.split(/\s+/)
    ;; adns
    antigen ; ZSH plugin management. TODO replace with antidote
    ;; aom
    ;; asciinema
    asdf ; tools version management
    ;; assimp
    babashka ; clojure cli scripting
    bat ; better cat alternative
    ;; bdw-gc
    ;; berkeley-db
    ;; bison
    ;; black
    ;; boost
    bottom ; better top util
    ;; brotli
    ;bun ; node.js alternative
    ;; burklee
    ;; bzip2
    ;; c-ares
    ;; ca-certificates
    ;; cjson
    clojure
    clojurescript
    ;; cmake
    ;; cmocka
    ;; concurrencykit
    coreutils
    cowsay ; terminal eye candy
    ;; ctags
    curlie ; better curl alternative
    ;; dav1d
    ;; dbus
    ;; deno
    ;; desktop-file-utils
    direnv
    ;; docbook
    ;; docbook-xsl
    ;; double-conversion
    ;; doxygen
    dust ; better du alternative for measuring dir size
    ;; ebook-tools
    ;; edencommon
    ;; entr
    exa ; better ls alternative
    ;; exiv2
    ;; extra-cmake-modules
    ;; fasd
    ;; fb303
    ;; fbthrift
    fd ; better find util
    ;; ffmpeg
    ;; fizz
    ;; flac
    ;; flex
    ;; flyway
    ;; fmt
    ;; folly
    ;; fontconfig
    fortune-mod ; beautiful quotes in the terminal. TODO include more quotes
    ;; freetype
    ;; frei0r
    ;; fribidi
    ;; fx
    fzf ; fuzzy search util
    ;; fzy
    ;; gcc
    ;; gd
    ;; gdbm
    ;; gdk-pixbuf
    ;; gettext
    ;; gflags
    ;; gh
    ;; ghc
    ;; ghostscript
    ;; giflib
    git ; version control system
    ;; git-delta ; TODO add the configs
    git-gui ; gitx and git gui commands
    ;; glib
    ;; glog
    ;; gmp
    ;; gnu-getopt
    gnu-sed ; standard sed util implementation
    ;; gnu-tar
    ;; gnupg
    ;; gnutls
    ;; go
    ;; gobject-introspection
    ;; gperf
    ;; gpgme
    ;; graphite2
    ;; graphviz
    ;; grpcurl
    ;; gts
    ;; guile
    ;; hades-cli
    ;; harfbuzz
    ;; highway
    ;; hmtools
    hub ; convenient github cli. TODO add configs
    ;; hunspell
    hyperfine ; terminal benchmark util
    ;; icu4c
    ijq ; interactive jq for json manipulation
    ;; ilmbase
    ;; imagemagick
    ;; imath
    ;; ipython
    ;; isl
    ;; ispell
    ;; jansson
    ;; jasper
    ;; jbig2dec
    ;; jemalloc
    ;; jet
    ;; jlog
    ;; jpeg
    ;; jpeg-turbo
    ;; jpeg-xl
    jq ; commandline json util
    ;just ; better make alternative
    ;; k6
    ;; kde-extra-cmake-modules
    ;; kf5-kdoctools
    ;; krb5
    ;; kubectl-site
    ;; kubectx
    ;; kubernetes-cli
    ;; lame
    ;lazygit ; git TUI
    ;; lazykube
    ;; leiningen
    ;; leptonica
    ;; libarchive
    ;; libass
    ;; libassuan
    ;; libavif
    ;; libb2
    ;; libbluray
    ;; libcanberra
    ;; libcbor
    ;; libcroco
    ;; libde265
    ;; libepoxy
    ;; libev
    ;; libevent
    ;; libffi
    ;; libfido2
    ;; libgccjit
    ;; libgcrypt
    ;; libgpg-error
    ;; libheif
    ;; libidn
    ;; libidn2
    ;; libksba
    ;; liblinear
    ;; liblqr
    ;; libmng
    ;; libmpc
    ;; libmtp
    ;; libnghttp2
    ;; libogg
    ;; libomp
    ;; libpng
    ;; libproxy
    ;; libpthread-stubs
    ;; libraw
    ;; librist
    ;; librsvg
    ;; libsamplerate
    ;; libsndfile
    ;; libsodium
    ;; libsoxr
    ;; libssh
    ;; libssh2
    ;; libtasn1
    ;; libtermkey
    ;; libtiff
    ;; libtool
    ;; libunistring
    ;; libusb
    ;; libusb-compat
    ;; libuv
    ;; libvidstab
    ;; libvmaf
    ;; libvorbis
    ;; libvpx
    ;; libvterm
    ;; libx11
    ;; libxau
    ;; libxcb
    ;; libxdmcp
    ;; libxext
    ;; libxml2
    ;; libxrender
    ;; libxslt
    ;; libyaml
    ;; libzip
    ;; little-cms2
    ;; llvm
    lolcat ; make terminal quotes colorful
    ;; lua
    ;; lua@5.3
    ;; luajit
    ;; luajit-openresty
    ;; luarocks
    ;; luv
    ;; lz4
    ;; lzo
    ;; m4
    ;; make
    maven ; java package manager
    ;; mbedtls
    ;; md4c
    ;; mitmproxy
    mob ; mob cli for mobbing
    ;; mosh
    ;; mpdecimal
    ;; mpfr
    ;; msgpack
    ;; mysql
    ;; ncurses
    neovide ; GUI for neovim
    neovim ; better vim alternative
    ;; netpbm
    ;; nettle
    ;; nghttp2
    ;; ninja
    ;; nmap
    ;; npth
    ;; nspr
    ;; nss
    ;; oha
    ;; onefetch
    ;; oniguruma
    ;; opencore-amr
    ;; openexr
    ;; openjpeg
    ;; openslp
    ;; openssl@1.1
    ;; opus
    ;; p11-kit
    ;; pandoc
    ;; pango
    ;; parallel
    ;; pcre
    ;; pcre2
    ;; perl
    ;; pgweb
    ;; pinentry
    ;; pixman
    ;; pkg-config
    ponysay ; cowsay alternative
    ;; poppler
    ;; postgresql
    ;; postgresql@13
    ;; postgresql@14
    ;; prettyping
    procs ; better ps alternative
    ;; protobuf
    ;; pygments
    ;ranger ; terminal file manager
    ;; rav1e
    ;; readline
    ;; recode
    ripgrep ; cli search util
    rlwrap ; readline cli util
    ;; rtmpdump
    ;; rubberband
    ;; rust
    ;; sbt
    ;; scala
    ;; scc
    ;; scio
    ;; sdl2
    ;; shared-mime-info
    ;; shellcheck
    ;; showkey
    ;; six
    ;; snappy
    ;; speedtest-cli
    ;; speex
    ;; spgrpcurl
    ;; spotify-disco
    ;; spotify-nameless-cli
    ;; sqlite
    ;; srt
    starship ; zsh prompt. TODO replace with powerlevel10k
    stow ; symlink management
    ;; styx-cli
    ;; taglib
    ;; tcl-tk
    ;; tesseract
    ;; texinfo
    ;; theora
    ;; tree-sitter
    ;; ttyplot
    ;; unbound
    ;; unibilium
    ;; unixodbc
    ;; utf8proc
    ;; v2ray
    ;; wakatime-cli
    ;; wangle
    watchexec ; run commands on file change
    ;; watchman
    ;; webp
    ;; websocat
    ;; wget
    ;; x264
    ;; x265
    ;; xmlto
    ;; xorgproto
    ;; xvid
    ;; xz
    ;; z
    ;; z3
    zellij ; better tmux alternative
    ;; zeromq
    ;; zimg
    ;; zlib
    zoxide ; better cd alternative. z command
    zsh
    ;; zstd
  HEREDOC
#+end_src

#+Name: brew-formulas
#+begin_src ruby :var formula_list=brew-formulas-requested
  installed = `brew list --formula`
  formula_list.reject { |formula| installed.include? formula }
#+end_src

#+RESULTS: brew-formulas
**** Casks

#+Name: brew-casks-requested
#+begin_src ruby
  <<HEREDOC.gsub(/;.*$/, '').split(/\s+/)
    alacritty ; terminal emulator
    ;blurred ; dim background apps windows
    browserosaurus ; select which browser. TODO replace with hammerspoon
    chromium
    coconutbattery ; battery info util
    ;; corretto
    ;; corretto8
    ;; edex-ui
    firefox
    flux
    ;; font-code-new-roman-nerd-font
    ;; font-dejavu-sans-mono-nerd-font
    font-droid-sans-mono-nerd-font
    ;; font-fira-code-nerd-font
    ;; font-firacode-nerd-font
    ;; font-hack-nerd-font
    ;; font-hasklig
    ;; font-hasklig-nerd-font
    font-iosevka-nerd-font
    font-jetbrains-mono-nerd-font
    font-juliamono
    ;; font-lilex
    ;; font-monoid-nerd-font
    ;; font-noto-nerd-font
    font-roboto-mono-nerd-font ; used for alacritty
    ;; font-victor-mono-nerd-font
    ;; github-beta
    ;; google-chrome
    google-cloud-sdk ; cli for google cloud
    hammerspoon ; desktop automation tool. TODO configs
    hiddenbar ; make taskbar icons hidden
    iina ; greate video player
    intellij-idea-ce
    itsycal ; calendar menubar
    ;; kitty
    ;; lapce
    logseq ; personal knowledge management
    ;; meetingbar
    ;; noisebuddy
    ;; noisy
    ;; qutebrowser
    ;; rectangle ; TODO migrate to hammerspoon
    ;; retinizer
    ;; spotify
    ;; swiftdefaultappsprefpane
    telegram
    ;; telegram-desktop
    ;; todoist
    tomatobar ; pomodoro menubar
    vimr ; another vim GUI
    visual-studio-code
    ;; xbar
  HEREDOC
#+end_src

#+Name: brew-casks
#+begin_src ruby :var cask_list=brew-casks-requested
  installed = `brew list --cask`
  cask_list.reject { |cask| installed.include? cask }
#+end_src

#+RESULTS: brew-casks
**** Install

#+Name: install-deps
#+begin_src shell :tangle setup.sh :var formula_list=brew-formulas cask_list=brew-casks tap_list=brew-taps
  while read -r tap || [[ -n "$tap" ]]; do
    brew tap "$tap";
  done <<< $tap_list
  while read -r formula || [[ -n "$formula" ]]; do
    brew install "$formula";
  done <<< $formula_list
  while read -r cask || [[ -n "$cask" ]]; do
    brew install --cask "$cask";
  done <<< $cask_list
#+end_src

#+begin_src ruby :var formula_list=brew-formulas cask_list=brew-casks tap_list=brew-taps
  tap_list.each { |tap| `brew tap "#{tap}"` }
  formula_list.each { |formula| `brew install "#{formula}"` }
  cask_list.each { |cask| `brew install --cask "#{cask}"` }
#+end_src

#+RESULTS:


#+RESULTS: install-deps


*** ASDF dependencies
**** Plugins

#+Name: requested_asdf_plugins
#+begin_src ruby
  requested_asdf_plugins = <<-HEREDOC.gsub(/;.*$/, '').strip.split(/\s+/)
    nodejs
    rust
  HEREDOC
#+end_src

#+RESULTS:
| node | rust |

#+begin_src ruby :var requested_asdf_plugins=requested_asdf_plugins
  installed_asdf_plugins = `asdf plugin list`
  requested_asdf_plugins
    .reject { |plugin| installed_asdf_plugins.include? plugin }
    .each do |plugin|
      `asdf plugin add "#{plugin}"`
      `asdf install "#{plugin}" latest`
    end
#+end_src

#+RESULTS:



** Link files

#+Name: symlink
#+begin_src shell :tangle setup.sh
  stow -t $HOME home_links
#+end_src

#+RESULTS: symlink
